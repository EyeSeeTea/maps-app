<!DOCTYPE html>
<head>
    <title>DHIS2 Maps Plugin</title>
    <script src="http://localhost:8080/dhis-web-core-resource/react/16.1.1/umd/react.development.js"></script>
    <script src="http://localhost:8080/dhis-web-core-resource/react-dom/16.1.1/umd/react-dom.development.js"></script>
    <script src="polyfill.min.js"></script>
    <script src="build/plugin.js"></script>

    <!-- <script src="plugin.js"></script> --> <!-- transpiled -->
    <style>
        body {
            margin: 10px;
            font-family: arial,sans-serif;
        }

        .wrapper {
            width: 350px;
            float: left;
            margin: 10px;
        }

        h1 {
            font-size: 12px;
            margin-top: 0;
        }

        .map {
            box-sizing: border-box;
            border: 1px solid #555;
            width: 100%;
            height: 350px;
            overflow: hidden;
        }
    </style>

    <script>

        var url = '//localhost:8080';
        var username = 'admin';
        var password = 'district';
        // var favoritesUrl = `${url}/api/29/maps.json?fields=id,displayName~rename(name)&paging=false`;
        var favoritesUrl = `${url}/api/29/maps.json?fields=id,displayName~rename(name)&pageSize=1&page=6`;
        var fetchOptions = { headers: { Authorization: 'Basic ' + btoa(`${username}:${password}`) } };

        mapsPlugin.url = url;
        mapsPlugin.username = username;
        mapsPlugin.password = password;
        mapsPlugin.loadingIndicator = true;

        // Fetch all favorites
        fetch(favoritesUrl, fetchOptions)
            .then(res => res.json())
            .then(data => data.maps)
            .then(maps => maps.map(createMapElement))
            .then(maps => mapsPlugin.load(maps))
            .catch(console.error);

        // Create map for each favorite
        function createMapElement(favorite) {
            const wrapperEl = document.createElement('div');
            wrapperEl.className = 'wrapper';

            const nameEl = document.createElement('H1');
            nameEl.innerText = favorite.name;

            const mapEl = document.createElement('div');
            mapEl.id = favorite.id;
            mapEl.className = 'map';

            wrapperEl.appendChild(nameEl);
            wrapperEl.appendChild(mapEl);

            document.body.appendChild(wrapperEl);

            favorite.el = favorite.id;

            return favorite;
        }

    </script>
</head>
<body></body>
</html>
